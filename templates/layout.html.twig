{% extends 'base.html.twig' %}

{% block body %}
    <turbo-stream
            {{ custom_turbo_stream_listen('player_gui_' ~ app.user.id) }}
    ></turbo-stream>
    <div class="row h-100">
        <div class="col-auto position-relative">
            <div class="bg-dark h-100 px-1" id="sidebarLeft">
                <ul class="nav nav-leftline flex-column h-100 align-items-center">
                    <li class="nav-item w-100">{{ app.user.map.name|trans|upper }}</li>
                    <li class="nav-item mt-auto w-100">
                        <a class="h3 nav-link" href="{{ path('app_logout') }}">LOGOUT</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col">
            <div class="navbar navbar-expand-lg bg-dark position-sticky top-0" style="z-index: 2">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#user-navbar" aria-controls="user-navbar" aria-expanded="false" aria-label="Toggle navbar">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="user-navbar">
                    <div class="navbar-nav w-100">
                        <div class="nav-item">
                            {{ app.user.name }}
                        </div>
                        <div class="nav-item col-12 col-lg-3">
                            <turbo-frame id="player_health_{{ app.user.id }}">
                                {{ component('HealthBar', {gameObject: app.user.gameObject}) }}
                            </turbo-frame>
                        </div>
                        <div class="nav-item col-12 col-lg-3">
                            <turbo-frame id="player_current_activity">
                            </turbo-frame>
                        </div>
                        <div class="nav-item ms-auto col-12 col-lg-auto text-center">
                            <button class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target="#inventory">Bag</button>
                        </div>
                        <div class="nav-item col-12 col-lg-auto text-center">
                            <button class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target="#stats">Stats</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <turbo-frame id="page">
                        {% block main %}{% endblock %}
                    </turbo-frame>
                </div>
                <div class="col-auto">
                    <div class="position-sticky sticky-top">
                        <div id="inventory" class="collapse m-1">
                            {{ component('Backpack')}}
                            {% set bag = player.equipment %}
                            <div class="card">
                                <div class="card-header bg-info">
                                    {{ 'equipped items'|trans|capitalize }}
                                    <div>
                                        <turbo-frame class="progress" id="item_bag_fullness_{{ bag.id }}">
                                            <div class="progress-bar bg-primary" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: {{ bag.fullness*100 }}%;"></div>
                                        </turbo-frame>
                                    </div>
                                </div>
                                <turbo-frame class="card-body d-flex flex-wrap" id="item_bag_content_{{ bag.id }}" src="{{ path('app_itemBag_content', {id: bag.id}) }}" loading="lazy">
                                </turbo-frame>
                            </div>
                        </div>
                        <div id="stats" class="collapse m-1">
                            <div class="card">
                                <div class="card-header bg-info">
                                    <div class="position-absolute top-0 end-0">
                                        <button class="btn btn-sm btn-secondary" data-bs-toggle="collapse" data-bs-target="#stats">
                                            <span class="fas fa-times"></span>
                                            <span>{{ "Close"|trans }}</span>
                                        </button>
                                    </div>
                                    <div class="card-title">{{ "Stats"|trans }}</div>
                                </div>
                                <div class="card-body">
                                    <turbo-frame id="player-character-stats" loading="lazy" src="{{ path('playerCharacter_stats') }}"></turbo-frame>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <turbo-frame id="notifications" class="position-fixed bottom-0 end-0">
    </turbo-frame>
{% endblock %}